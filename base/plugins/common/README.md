# Common functionality for [RITE](../../README.md)
This plugin contains some common transformers and exporters. To use them, 
include the plugin in the rite-XML:
```xml
<rite>
    <plugins>
        <!-- If the plugin is not in the LD_LIBRARY_PATH, provide a "path" attribute -->
        <plugin id="common" name="rite_common"/>
    </plugins>
</rite>
```
## Transformer
### Generic
This transformer is returned, when the `name` is empty. It contains several 
field modifiers.
```xml
    <!-- ... -->
            <transformers>
                <transformer plugin="common">
                    <!-- Configuration goes here -->
                <transformer>
            <transformers>
    <!-- ... -->
```
The transformer applies multiple field modifieres to all fields of the given 
record. What modifiere will be applied is determined by a configuration variable,
that has the name of the modifiere and a modifier specific value.
```xml
    <!-- ... -->
            <transformers>
                <transformer plugin="common">
                    <configuration>
                        <config key="<modifier-name>" value="<modifier-parameter>" />
                    </configuration>
                <transformer>
            <transformers>
    <!-- ... -->
```
#### Modifiers
Here is a list of currently supported modifiers and their configuration options.
##### add_field
This modifier adds a new field to the record. The configuration value is a colon 
separated list. The first element is the name of the new field. The secod parameter
is the type of the new field. All fields are automatically calculated, there is no 
way to supply a user defined value.
###### Field types
* `uuid` - The new field will be a String representing a v4 uuid (generated by the crate [uuid](https://crates.io/crates/uuid))
* `autoinc` - The new field will be a integer value, which is automatically incremented,
beginning with 1. The type of the field is i32
###### Example
```xml
    <config key="add_field" value="id:uuid" />
    <config key="add_field" value="number:autoinc" />
```

##### rename_field
This modifier renames an existing field. The configuration value is a colon 
separated list. The first element is the name of the existing field. The secod parameter
is the new name of the field.
###### Example
```xml
    <config key="rename_field" value="oldfieldname:newfieldname" />
```
##### ignore_field
This modifier controls, which fields should be ignored in the resulting record.
When given, the fields in the list will not be included in the resulting record.
The configuration value is a comma separated list of field names.
###### Example
```xml
    <config key="ignore_field" value="field1,field2" />
```
In this case the fields with name `field1` or `field2` will **not** be part of the 
resulting record

##### include_field
This modifier controls, which fields should be included in the resulting record.
When given, only fields in the list will be exported. The configuration value is 
a comma separated list of field names.
###### Example
```xml
    <config key="include_field" value="field1,field2" />
```
In this case only the field with name `field1` or `field2` will be part of the 
resulting record

### Mapper
This transformer is returned, when the `name` is `mapper`. 
```xml
    <!-- ... -->
            <transformers>
                <transformer plugin="common" name="mapper">
                    <!-- Configuration goes here -->
                <transformer>
            <transformers>
    <!-- ... -->
```
The configuration for the transformer is done in a separate XML file
```xml
    <!-- ... -->
            <transformers>
                <transformer plugin="common" name="mapper">
                    <configuration xml="mapper-config.xml" />
                <transformer>
            <transformers>
    <!-- ... -->
```
Here is a detailed documentation of the [Mapper transformer](mapper.md)


## Exporter
### Console
The `console` exporter prints the record on standard output. 
```xml
    <exporters>
        <exporter plugin="common" name="console">
            <configuration>
                <config key="prefix" value="<prefix-to-print-before-record>" />
                <config key="postfix" value="<postfix-to-print-after-record>" />
                <config key="separator" value="&#xA;" /> 
                <config key="field-prefix" value=" " />
            </configuration>
        </exporter>    
    </exporters>
```
#### Configuration
| Key | Description | Default |
| --- | --- | --- |
| prefix | The optional configuration `prefix` can be used, to print a leading text.| |
| postfix | The optional configuration `postfix` can be used, to print a trailing text.  | |
| separator | The optional configuration `separator` can be used, to print an alternative separator for the fields. | ", " |
| field-prefix | The optional configuration `field-prefix` can be used, to print an additional text before each field | |

Every record will then be printed, with the fields separated by the `separator`:
```xml
<prefix>
<field-prefix>record.field1=record.value1<separator><field-prefix>record.field2=record.value2
<postfix>
```
To print each field indented by some spaces on separate lines and brackets around each record, you can use this configuration:
```xml
    <config key="prefix" value="(" />
    <config key="postfix" value=")" />
    <config key="separator" value="&#xA;" /> 
    <config key="field-prefix" value="   " />
```
This will result in an output like this:
```
(
    record1.field1=record1.value1
    record1.field2=record1.value2
)
(
    record2.field1=record2.value1
    record2.field2=record2.value2
)
```
### Template
The `template` exporter takes all records and at the end of the import passes the records to the [Tera](https://keats.github.io/tera/docs/#templates) template engine.

```xml
    <exporters>
        <exporter plugin="common" name="template">
            <configuration>
                <config key="templateFile" value="<path-of-the-template-file>" />
                <config key="outputFile" value="<path-of-the-outputfile>" />
            </configuration>
        </exporter>    
    </exporters>
```
#### Configuration
| Key | Description | 
| --- | --- |
| templateFile | The pathname of the template file, which prints the records |  
| outputFile | The pathname of the output file. After the template has been rendered, the result will be written into this file. The file will be overwritten |  

#### Variables for the template
The plugin will provide a array of all records from the input. The name of the array in the template is `records`. To process them, a loop over records can be done like this:
```
{% for record in records %}
    {{ record.id }}
{% endfor %}
```
In the above example, the record is assumed to have a field with the name `id`. To access any field in a record, the notation `record.<fieldname>` acn be used.
For a detailed documentation of all the features of the Tera template language, have a look at [their documentation](https://keats.github.io/tera/docs/#templates)